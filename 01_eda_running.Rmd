---
title: "Exploratory Data Analysis of Hilary's Running Data (12/2016-11/2020)"
author: "Hilary M. Dotson"
date: "11/27/2020"
output: 
  rmarkdown::github_document
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(tidyverse)
library(magrittr)
library(lubridate)
```

# Purpose

The purpose of this RMD is to provide a short exploratory data analysis of my own personal Garmin running data from December 2016 through November 2020.  It's fun for me to be a little navel gaze-y and tell my "running story" through some really basic exploratory data analyses. 

# Data Preprocessing
In preparing these data, I completed several steps ahead of the analysis: 

1. Load the locally saved Garmin data. 
2. Examine the data. 
3. Blanket change column names to tidy-convention. 
4. Remove the columns containing unnecessary data. 
5. Convert dates and time from factors and characters to appropriate date/time measurement.

```{r}
# Load locally saved Garmin data
garmin_data <- read.csv("dotson_running.csv")

# Examine data
str(garmin_data)

# Change column names --
## Remove periods and replace with underscores. 
names(garmin_data) <- gsub("\\.", "_", names(garmin_data)) 

## Remove non-English character and underscore in 1 column
names(garmin_data) <- gsub("Ã‚_", "", names(garmin_data))

## Convert all variable names to lowercase. 
garmin_data %<>% dplyr::rename_all(tolower)

# De-select unnecessary columns
garmin_data %<>%
  dplyr::select(-c(favorite, avg_vertical_ratio, avg_vertical_oscillation,
                   training_stress_score, grit, flow, bottom_time, min_temp,
                   surface_interval, decompression, max_temp, climb_time))

# Date/time conversions
## Convert date/time variables to date and time from YMD HMS character.
garmin_data$date <- lubridate::ymd_hms(garmin_data$date) 


## Convert "time" (duration of run) to HMS format time from HMS character
garmin_data$time <- lubridate::hms(garmin_data$time)
### Convert HMS format time to period measured in seconds 
garmin_data$time <- lubridate::seconds(garmin_data$time)


## Convert "avg_pace" to MS format time from MS character
garmin_data$avg_pace <- lubridate::ms(garmin_data$avg_pace)
### Convert MS format time to period measured in seconds 
garmin_data$avg_pace <- lubridate::seconds(garmin_data$avg_pace)

```

Now that the conversions are complete, let's take a look at the cleaned data.

```{r}

# Re-examine data
str(garmin_data)

```

# Quick Summary Statistics
Now, let's take a look at some key running statistics.  In particular, for the `nrow(garmin_data)` runs I did, let's take a look at how long I was out there, my average pace, and my distance.

```{r}
# Calculate summary statistics
time_running <- summary(garmin_data$time)
pace_running <- summary(garmin_data$avg_pace)
distance_running <- summary(garmin_data$distance)

# Column bind to present together
td_running <- cbind(time_running, distance_running, pace_running)

td_running

```

Based on the first quartile and median, we can tell that about half of my runs were approximately 30 minutes long and in the 3.25-3.5 mile range.  Now, let's take a look at how long I spent running.

# Time Spent Running Over Time
Now, a quick visual inspection of the full run data.frame, examining how much time each of my runs took over time.

```{r, message = FALSE}
garmin_data %>%
  ggplot2::ggplot(aes(date, time)) +
  ggplot2::geom_line() +
  ggplot2::geom_smooth() +
  ggplot2::scale_y_time() +
  ggplot2::labs(title = "All Tracked Runs, 2016 - 2020",
       x = "Year", 
       y = "Run Duration") +
  ggplot2::theme_minimal()

```

You'll notice that nearly all of my runs are under two hours---not at all surprising given the summary statistics shown above.  But what happened in 2017?  Why the spike?  Well, when I first started running regularly in 2016, I had a goal to do a 10k by my birthday.  Then, a half marathon less than six months later.  And finally, I wanted to do a marathon around my 30th birthday.  Technically, I did it a week after (in Richmond).  So you will notice that my "long runs" became considerably longer in the latter half of 2017.  

After one marathon though, I was *DONE*.  I had a very hard time with the marathon, even though my training was mostly successful.  It took me far longer than anticipated, and for the first and only time in my life, I started having muscle spasms while running---during mile 18, so 8 more miles with that.  In short, I have no interest in doing a marathon again.  Honestly, I like the 10 mile distance the best, but anything from a 5k to a half marathon I'm down for. 

So, let's re-scale the graphic to exclude runs that took longer than 2:30.  Why 2:30?  Well, my first half marathon was just shy of that, and I gradually became faster over time (as we saw earlier--minus a few injuries, which I'll examine in more detail in future RMDs).

To do this, I'm actually going to create a new column that sets the original "time" column to NA if the time value is greater than 2:30 (or, 9,000 seconds).

```{r}
# Convert the lubridate formatted time variable to a numeric variable measured in seconds.
garmin_data$time_numeric <- lubridate::time_length(garmin_data$time, unit = "seconds")

garmin_data %<>%
  dplyr::mutate(short_time = case_when(
    time_numeric > 9000 ~ NA_real_,
    TRUE ~ time_numeric
  )) 

# Convert the numeric short_time variable to period format
garmin_data$short_time <- lubridate::as.period(garmin_data$short_time)


```

Next, for good measure, let's take a quick look at the summary statistics for the ```!is.na(nrows(garmin_data))``` runs I completed which were less than 2H 30M in duration. 

```{r, message = FALSE, warning=FALSE}
garmin_data %>%
  ggplot2::ggplot(aes(date, short_time)) +
  ggplot2::geom_line() +
  ggplot2::geom_smooth() +
  ggplot2::scale_y_time() +
  ggplot2::labs(title = "All Runs Lasting 2H 30M or Shorter, 2016 - 2020",
       x = "Year", 
       y = "Run Duration") +
  ggplot2::theme_minimal()

```

You get a much clearer picture of what my "typical" runs actually look like in terms of the amount of time I spent out there running. But has my pace improved at all in this time?

# Pace Over Time
I have a feeling that from when I started running to the present my pace has more or less improved.  I have had a few injuries in the last few years, but on the whole, am I any faster than I used to be?

First, let's take a look at some descriptive statistics, parsed by year. To do this, I'm going to create five separate data.frames---one for each of the calendar years I spent time running. 

```{r}
garmin_2016 <- garmin_data %>%
  dplyr::filter(date >= "2016-01-01 00:00:00" & date <= "2016-12-31 23:59:59")  

garmin_2017 <- garmin_data %>%
  dplyr::filter(date >= "2017-01-01 00:00:00" & date <= "2017-12-31 23:59:59")  

garmin_2018 <- garmin_data %>%
  dplyr::filter(date >= "2018-01-01 00:00:00" & date <= "2018-12-31 23:59:59")  

garmin_2019 <- garmin_data %>%
  dplyr::filter(date >= "2019-01-01 00:00:00" & date <= "2019-12-31 23:59:59")  

garmin_2020 <- garmin_data %>%
  dplyr::filter(date >= "2020-01-01 00:00:00" & date <= "2020-12-31 23:59:59")  

```

From here, I just want to see how many runs I completed in each year. 

```{r}
nrow_2016 <- nrow(garmin_2016)
nrow_2017 <- nrow(garmin_2017)
nrow_2018 <- nrow(garmin_2018)
nrow_2019 <- nrow(garmin_2019)
nrow_2020 <- nrow(garmin_2020)
nrow_all <- cbind(nrow_2016, nrow_2017, nrow_2018, nrow_2019, nrow_2020)

nrow_all
```

I only completed ```nrow(garmin_2016)``` runs in 2016---that's actually not true, but it's all I have tracked.  I didn't own a Garmin until December 2016, so very few of my runs were actually tracked.  That said, most of 2016 I was just completing the Couch to 5K program so a lot more "run/walking" than actually running.  By the time December hit, I had already completed both a 5K and 10K race---so I was consistently "running."

From here, let's check out my pace over time. 

```{r}

pace_2016 <- summary(garmin_2016$avg_pace)
pace_2017 <- summary(garmin_2017$avg_pace)
pace_2018 <- summary(garmin_2018$avg_pace)
pace_2019 <- summary(garmin_2019$avg_pace)
pace_2020 <- summary(garmin_2020$avg_pace)

pace_sum <- cbind(pace_2016, pace_2017, pace_2018, pace_2019, pace_2020)

pace_sum

```

Pretty clear strides made! Now let's check it on a time series graph, using the full garmin_data data.frame.

```{r, message = FALSE, warning=FALSE}
garmin_data %>%
  ggplot2::ggplot(aes(date, avg_pace)) +
  ggplot2::geom_line() +
  ggplot2::geom_smooth() +
  ggplot2::scale_y_time() +
  ggplot2::labs(title = "Average Pace, 2016 - 2020",
       x = "Year", 
       y = "Average Pace") +
  ggplot2::theme_minimal()

```

Okay, cool! Pretty clearly became faster over time... until late 2020.  What happened?  The short answer is I had multiple injuries in late 2019 and mid 2020, so I ran a lot less *AND*  I started run-walking again to try to run  while dealing with a significant shoulder injury.  The massive spike at the end of 2020 is the result of some 6-10 mile run/walks, where I ran about half the time and walked the other half.  I wanted to keep running, but was afraid I would over-do it while wearing a sling.  Probably shouldn't have been out at all, but what can I say?

Now, let's take a look at time against distance!

# Time and Distance Running

As I did with the tables earlier, let's take a look at the distance against the time I spent running. First, let's examine the correlation.  For this, we'll use the time_numeric variable from the garmin_data data.frame, which represents the time, in seconds, I spent running during each run.  The Pearson's R is ```round(cor(garmin_data$time_numeric, garmin_data$distance), digits = 2)```---indicating a very strong and positive relationship between the time I spent running and the distance I ran.  That's a relief!  That said, from the previous analyses, we know there were some blips...

Now, just for fun, let's plot time and distance against one another.

```{r, message = FALSE, warning=FALSE}
garmin_data %>%
  ggplot2::ggplot(aes(time, distance)) +
  ggplot2::geom_line() +
  ggplot2::geom_smooth() +
  ggplot2::scale_x_time() +
  ggplot2::labs(title = "Time and Distance Running, 2016 - 2020",
       x = "Run Duration", 
       y = "Distance Ran") +
  ggplot2::theme_minimal()


```

Shocking -- the longer runs took more time!

# Conclusion

In short, I've ran quite a bit in the last four years.  I'm looking forward to running again once I'm cleared to do so.  I know I'll have to start out slow, but hoping to get close to where I was at late 2019.